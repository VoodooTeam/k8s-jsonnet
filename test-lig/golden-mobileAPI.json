{
  "deploy": {
    "apiVersion": "apps/v1",
    "kind": "Deployment",
    "metadata": {
      "labels": {
        "app": "mobile-api"
      },
      "name": "mobile-api"
    },
    "spec": {
      "revisionHistoryLimit": 2,
      "selector": {
        "matchLabels": {
          "app": "mobile-api"
        }
      },
      "template": {
        "metadata": {
          "labels": {
            "app": "mobile-api"
          }
        },
        "spec": {
          "containers": [
            {
              "env": [
                {
                  "name": "ACTIVITY_SERVICE",
                  "value": "http://activity:8080"
                },
                {
                  "name": "ANDROID_MIN_APPVERSION",
                  "value": "1.0.0"
                },
                {
                  "name": "APP_ENV",
                  "value": "dev"
                },
                {
                  "name": "APP_NAME",
                  "value": "MobileAPI"
                },
                {
                  "name": "BADGE_SERVICE",
                  "value": "http://badge:8080"
                },
                {
                  "name": "FIREBASE_PROJECT_ID",
                  "value": "ligdev"
                },
                {
                  "name": "GAME_SERVICE",
                  "value": "http://game:8080"
                },
                {
                  "name": "IAP_SERVICE",
                  "value": "http://iap:8080"
                },
                {
                  "name": "IOS_MIN_APPVERSION",
                  "value": "1.3.0"
                },
                {
                  "name": "LEADERBOARD_SERVICE",
                  "value": "http://leaderboard:8080"
                },
                {
                  "name": "LEAGUE_SERVICE",
                  "value": "http://league:8080"
                },
                {
                  "name": "LIG_SVC_TOURNAMENTS",
                  "value": "tournaments:10000"
                },
                {
                  "name": "NOTIFICATION_SERVICE",
                  "value": "http://notification:8080"
                },
                {
                  "name": "NR_APP_NAME",
                  "value": "GP-Lig-Mobile-API-dev"
                },
                {
                  "name": "PORT",
                  "value": ":8080"
                },
                {
                  "name": "USER_SERVICE",
                  "value": "http://user:8080"
                }
              ],
              "envFrom": [
                {
                  "secretRef": {
                    "name": "new-relic"
                  }
                }
              ],
              "image": "456072703506.dkr.ecr.eu-west-1.amazonaws.com/gaming-platform/lig/mobile-api:f4428e2d76d2cd42038e39dcea183e9646ee28bc",
              "imagePullPolicy": "Always",
              "name": "mobile-api",
              "ports": [
                {
                  "containerPort": 8080
                }
              ],
              "resources": {
                "requests": {
                  "cpu": "100m",
                  "memory": "50Mi"
                }
              },
              "securityContext": {
                "allowPrivilegeEscalation": false,
                "capabilities": {
                  "drop": [
                    "ALL"
                  ]
                }
              }
            }
          ],
          "securityContext": {
            "fsGroup": 2000,
            "runAsGroup": 3000,
            "runAsUser": 1000
          },
          "serviceAccountName": "mobile-api"
        }
      }
    }
  },
  "hpa": {
    "apiVersion": "autoscaling/v2beta2",
    "kind": "HorizontalPodAutoscaler",
    "metadata": {
      "labels": {
        "app": "mobile-api"
      },
      "name": "mobile-api"
    },
    "spec": {
      "maxReplicas": 100,
      "metrics": [
        {
          "resource": {
            "name": "memory",
            "target": {
              "averageUtilization": 150,
              "type": "Utilization"
            }
          },
          "type": "Resource"
        },
        {
          "resource": {
            "name": "cpu",
            "target": {
              "averageUtilization": 150,
              "type": "Utilization"
            }
          },
          "type": "Resource"
        }
      ],
      "minReplicas": 1,
      "scaleTargetRef": {
        "apiVersion": "apps/v1",
        "kind": "Deployment",
        "name": "mobile-api"
      }
    }
  },
  "ingress": {
    "apiVersion": "networking.k8s.io/v1beta1",
    "kind": "Ingress",
    "metadata": {
      "annotations": {
        "cert-manager.io/issuer": "letsencrypt-prod",
        "kubernetes.io/ingress.class": "nginx",
        "kubernetes.io/tls-acme": "true",
        "nginx.ingress.kubernetes.io/force-ssl-redirect": "true",
        "nginx.ingress.kubernetes.io/proxy-body-size": "8m"
      },
      "labels": {
        "app": "mobile-api"
      },
      "name": "mobile-api"
    },
    "spec": {
      "rules": [
        {
          "host": "lig-mobile-api.dev-vlbapps.com",
          "http": {
            "paths": [
              {
                "backend": {
                  "serviceName": "mobile-api",
                  "servicePort": 8080
                },
                "path": "/",
                "pathType": "Prefix"
              }
            ]
          }
        }
      ],
      "tls": [
        {
          "hosts": [
            "lig-mobile-api.dev-vlbapps.com"
          ],
          "secretName": "mobile-api-cert"
        }
      ]
    }
  },
  "sa": {
    "apiVersion": "v1",
    "kind": "ServiceAccount",
    "metadata": {
      "labels": {
        "app": "mobile-api"
      },
      "name": "mobile-api"
    }
  },
  "svc": {
    "apiVersion": "v1",
    "kind": "Service",
    "metadata": {
      "labels": {
        "app": "mobile-api"
      },
      "name": "mobile-api"
    },
    "spec": {
      "ports": [
        {
          "port": 8080
        }
      ],
      "selector": {
        "app": "mobile-api"
      }
    }
  }
}
